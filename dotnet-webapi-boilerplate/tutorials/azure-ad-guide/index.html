<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.12.1/css/all.css crossorigin=anonymous><link rel=preload as=font href=https://fullstackhero.net/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://fullstackhero.net/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://fullstackhero.net/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://fullstackhero.net/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://fullstackhero.net/main.3c0c4aba459853be840a5730e7f0776bb71ef1fed839ce06968e9b204f014cba43621cd72e2d28280df277af30c06e3fc356530e117a724547fdc5d2a01206f3.css integrity="sha512-PAxKukWYU76EClcw5/B3a7ce8f7YOc4Glo6bIE8BTLpDYhzXLi0oKA3yd68wwG4/w1ZTDhF6ckVH/cXSoBIG8w==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Setting up Azure AD Authentication - fullstackhero</title><meta name=description content="Setting up Azure AD Authentication with fullstackhero's Web API"><link rel=canonical href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Setting up Azure AD Authentication"><meta property="og:description" content="Setting up Azure AD Authentication with fullstackhero's Web API"><meta property="og:url" content="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/"><meta property="og:site_name" content="fullstackhero"><meta property="article:published_time" content="2021-08-30T00:59:34+05:30"><meta property="article:modified_time" content="2022-01-15T22:13:49+05:30"><meta property="og:image" content="https://fullstackhero.net/doks.png"><meta property="og:image:alt" content="fullstackhero"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@codewithmukesh"><meta name=twitter:creator content="@iammukeshm"><meta name=twitter:title content="Setting up Azure AD Authentication"><meta name=twitter:description content="Setting up Azure AD Authentication with fullstackhero's Web API"><meta name=twitter:image content="https://fullstackhero.net/doks.png"><meta name=twitter:image:alt content="Setting up Azure AD Authentication"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://fullstackhero.net/#/schema/organization/1","name":"fullstackhero","url":"https://fullstackhero.net/","sameAs":["https://twitter.com/codewithmukesh","https://github.com/fullstackhero"],"logo":{"@type":"ImageObject","@id":"https://fullstackhero.net/#/schema/image/1","url":"https://fullstackhero.net/logo-doks.png","width":512,"height":512,"caption":"fullstackhero"},"image":{"@id":"https://fullstackhero.net/#/schema/image/1"}},{"@type":"WebSite","@id":"https://fullstackhero.net/#/schema/website/1","url":"https://fullstackhero.net/","name":"fullstackhero","description":"fullstackhero is a collection of Enterprise Level Boilerplates for Modern Web Applications that gets you started with premium application development in no-time!","publisher":{"@id":"https://fullstackhero.net/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/","url":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/","name":"Setting up Azure AD Authentication","description":"Setting up Azure AD Authentication with fullstackhero\u0027s Web API","isPartOf":{"@id":"https://fullstackhero.net/#/schema/website/1"},"about":{"@id":"https://fullstackhero.net/#/schema/organization/1"},"datePublished":"2021-08-30T00:59:34CET","dateModified":"2022-01-15T22:13:49CET","breadcrumb":{"@id":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/"]}]},{"@type":"BreadcrumbList","@id":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://fullstackhero.net/","url":"https://fullstackhero.net/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://fullstackhero.net/dotnet-webapi-boilerplate/","url":"https://fullstackhero.net/dotnet-webapi-boilerplate/","name":"Dotnet Webapi Boilerplate"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/","url":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/","name":"Tutorials"}},{"@type":"ListItem","position":4,"item":{"@id":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/#/schema/image/2","url":"https://fullstackhero.net/doks.png","contentUrl":"https://fullstackhero.net/doks.png","caption":"Setting up Azure AD Authentication"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://fullstackhero.net/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://fullstackhero.net/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://fullstackhero.net/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://fullstackhero.net/site.webmanifest></head><body><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label>
<a class="navbar-brand order-1 order-md-0 me-auto" href=https://fullstackhero.net/><img src=https://fullstackhero.net/images/navbar-logo.png alt="FullStackHero Logo" style=max-width:40px>
fullstack<b style=font-weight:600>hero</b></a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://twitter.com/codewithmukesh><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ms-2 visually-hidden">Twitter</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/fullstackhero/><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link style=white-space:nowrap href=https://fullstackhero.net/dotnet-webapi-boilerplate>Web API</a></li><li class=nav-item><a class=nav-link style=white-space:nowrap href=https://fullstackhero.net/blazor-wasm-boilerplate>Blazor</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/general/>General</a></h3><ul id=General-children class=list-unstyled><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/general/overview/><span style=vertical-align:middle>Overview</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/general/development-environment/><span style=vertical-align:middle>Development Environment</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/general/getting-started/><span style=vertical-align:middle>Getting Started</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/general/api-testing/><span style=vertical-align:middle>API Testing</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/general/cli-commands/><span style=vertical-align:middle>CLI Commands</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/general/project-structure/><span style=vertical-align:middle>Project Structure</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/general/changelogs/><span style=vertical-align:middle>Changelogs</span></a></li></ul><h3><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/>Fundamentals</a></h3><ul id=Fundamentals-children class=list-unstyled><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/configurations/><span style=vertical-align:middle>Configurations</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/exception-handling/><span style=vertical-align:middle>Exception Handling</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/localization/><span style=vertical-align:middle>Localization</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/application-startup/><span style=vertical-align:middle>Application Startup</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/caching/><span style=vertical-align:middle>Caching</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/cors/><span style=vertical-align:middle>CORS</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/hangfire/><span style=vertical-align:middle>Hangfire</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/logging/><span style=vertical-align:middle>Logging</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/mail-service/><span style=vertical-align:middle>Mail Service</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/middlewares/><span style=vertical-align:middle>Middlewares</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/multitenancy/><span style=vertical-align:middle>Multitenancy</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/security/><span style=vertical-align:middle>Security</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/signalr/><span style=vertical-align:middle>SignalR</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/fundamentals/swagger/><span style=vertical-align:middle>Swagger</span></a></li></ul><h3><a class="docs-link active" href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/>Tutorials</a></h3><ul id=Tutorials-children class="list-unstyled show"><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/><span style=vertical-align:middle>Azure AD Authentication</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/adding-migrations/><span style=vertical-align:middle>Database Migrations</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/crud-guide/><span style=vertical-align:middle>Implementing CRUD</span></a></li><li><a class=docs-link href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/deploying-to-iis/><span style=vertical-align:middle>Deploying to IIS</span></a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div><h6>SUPPORT THE PROJECT</h6><p style=font-size:.9375rem><b>Like fullstackhero?</b> Support the project by buying me a coffee!</p><a class="btn btn-primary btn-lg px-4 mb-2" style=font-size:medium href=https://www.buymeacoffee.com/codewithmukesh target=_blank role=button><i style=margin-right:5px class="fas fa-mug-hot"></i>Buy me
a Coffee</a>
<a class="btn btn-primary btn-lg px-4 mb-2" style=font-size:medium href=https://opencollective.com/fullstackhero target=_blank role=button><i style=margin-right:5px class="fas fa-star"></i> Sponsor</a>
<a class="btn btn-primary btn-lg px-4 mb-2" style=font-size:medium href=https://discord.gg/HkhnYb3mCN target=_blank role=button><i style=margin-right:5px class="fas fa-inbox"></i> Join Discord</a></div><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#create-the-fshapi-application-registration>Create the FSHApi Application Registration</a><ul><li><a href=#expose-the-api>Expose the Api</a></li><li><a href=#add-app-roles>Add App roles</a></li></ul></li><li><a href=#assign-app-roles-to-specific-users-in-azuread>Assign App roles to specific users in AzureAD</a></li><li><a href=#create-the-client-application-registration>Create the Client Application Registration</a><ul><li><a href=#add-permission-for-the-api>Add permission for the Api</a></li><li><a href=#add-blazor-client-application>Add Blazor Client application</a></li></ul></li><li><a href=#update-the-azuread-settings-on-the-web-api-project>Update the AzureAd settings on the Web Api project</a></li><li><a href=#update-the-azuread-settings-on-the-blazor-client-project>Update the AzureAd settings on the Blazor Client project</a></li><li><a href=#configuration-for-postman>Configuration for Postman</a></li><li><a href=#test-it-out>Test it out</a></li><li><a href=#azuread-and-multitenancy>AzureAd and multitenancy</a></li><li><a href=#azuread-usersroles-vs-local-usersroles>AzureAd users/roles vs. local users/roles</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-11"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=https://fullstackhero.net/dotnet-webapi-boilerplate/>.NET Web API Boilerplate</a></li><li class=breadcrumb-item><a href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/>Tutorials</a></li><li class="breadcrumb-item active" aria-current=page>Setting up Azure AD Authentication</li></ol></nav><h1>Setting up Azure AD Authentication</h1><div class=views style=margin-bottom:20px><span class=views><img src="https://api.visitorbadge.io/api/visitors?path=https%3a%2f%2ffullstackhero.net%2fdotnet-webapi-boilerplate%2ftutorials%2fazure-ad-guide%2f&label=Views&labelColor=%233eaf7c&countColor=%231b1f22&style=flat"></span></div><p class=lead>Setting up Azure AD Authentication with fullstackhero's Web API</p><p>For the Azure AD integration to work with this template, you have to create 2 <code>App Registrations</code> under your Azure AD tenant with the right settings, and then fill out the <code>AzureAd</code> section in <code>Configurations/security.json</code> to hook those apps up. This guide will walk you through doing all that.</p><h2 id=create-the-fshapi-application-registration>Create the FSHApi Application Registration<a href=#create-the-fshapi-application-registration class=anchor aria-hidden=true>#</a></h2><ul><li><p>Log into the azure portal and go to the <a href=https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade>Azure Active Directory blade</a>. Make sure you are in the directory where you want your apps to be registered. You can switch directories by clicking on your account info in the top right corner.</p></li><li><p>Under <code>Manage</code>, click on <code>App registrations</code>, and click the <code>New registration</code> button on top:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_500x0_resize_lanczos_3.png 500w" width=906 height=595><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration_hufab59fda526ebd0068b3059bb1e970fb_46177_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/new-registration.png width=906 height=595></noscript></figure></p></li><li><p>Fill in <code>FSHApi</code> (or whichever name you want for this app) as <code>Name</code>. Under <code>Supported account types</code> select <code>Accounts in any organizational directory - Multitenant</code> and click on <code>Register</code>:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_500x0_resize_lanczos_3.png 500w" width=845 height=566><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api.png width=845 height=566></noscript></figure></p></li></ul><h3 id=expose-the-api>Expose the Api<a href=#expose-the-api class=anchor aria-hidden=true>#</a></h3><ul><li><p>On the newly created App&rsquo;s blade, under <code>Manage</code>, click on <code>Expose an API</code>, then click on <code>Add a scope</code>:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_500x0_resize_lanczos_3.png 500w" width=890 height=568><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1_hu802e1da739294b48e8662efd5630fed6_38390_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-1.png width=890 height=568></noscript></figure></p></li><li><p>An <code>Application ID URI</code>q will automatically be filled out. Click on <code>Save and continue</code>:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_500x0_resize_lanczos_3.png 500w" width=580 height=284><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2_hud2b1b880fd5c0454afd53a55d6c1e11c_11182_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-2.png width=580 height=284></noscript></figure></p></li><li><p>On the next screen, fill in <code>access_as_user</code> as <code>Scope name</code>, select <code>Admins and users</code> as <code>Who can consent?</code> and fill out the display names and descriptions like in the screenshot below, then click on <code>Add scope</code>:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_500x0_resize_lanczos_3.png 500w" width=577 height=670><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3_hua3fea6d7066e01b6afd2485087512915_22548_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-scope-3.png width=577 height=670></noscript></figure></p></li></ul><h3 id=add-app-roles>Add App roles<a href=#add-app-roles class=anchor aria-hidden=true>#</a></h3><ul><li><p>Under <code>Manage</code>, click on <code>App roles</code> and click the <code>Create app role</code> button on top:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_500x0_resize_lanczos_3.png 500w" width=899 height=505><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1_hu6513f0c8ba2e0c6aff6e02cfa16f5f76_27706_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-1.png width=899 height=505></noscript></figure></p></li><li><p>Fill in <code>Administrators</code> as Display name and <code>Admin</code> as value. Especially the value is important, as this has to match the name of the role in the FSH application itself. Click on Apply:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_500x0_resize_lanczos_3.png 500w" width=584 height=568><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2_hud55b01dae692884065a2503a1c2de549_16291_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/create-app-role-2.png width=584 height=568></noscript></figure></p></li><li><p>In the same way, create app roles for the other roles in your application (by default the only other role is the <code>Basic</code> role).</p></li></ul><h2 id=assign-app-roles-to-specific-users-in-azuread>Assign App roles to specific users in AzureAD<a href=#assign-app-roles-to-specific-users-in-azuread class=anchor aria-hidden=true>#</a></h2><p>You will have to assign those freshly created App roles to the AzureAd users to which you want to grant access to your application:</p><ul><li><p>On the <a href=https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade>Azure Active Directory blade</a>, under <code>Manage</code> click on <code>Enterprise applications</code> and select the FSHApi application:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_500x0_resize_lanczos_3.png 500w" width=936 height=586><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1_hu6885f31c7964f0fdf1e873cb9677ad5d_43328_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-1.png width=936 height=586></noscript></figure></p></li><li><p>Under <code>Manage</code>, click on <code>Users and groups</code> and click the <code>Add user/group</code> button on top:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_500x0_resize_lanczos_3.png 500w" width=949 height=372><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2_hu5c60cd8225cab4ddf52eeef82d4311e9_26128_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/assign-app-roles-2.png width=949 height=372></noscript></figure></p></li><li><p>On the next screen, you can select one or more users/groups, select an App role and click on the <code>Assign</code> button to assign the role the the specified users/groups.</p></li></ul><h2 id=create-the-client-application-registration>Create the Client Application Registration<a href=#create-the-client-application-registration class=anchor aria-hidden=true>#</a></h2><ul><li><p>Go back again to the <a href=https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade>Azure Active Directory blade</a> and under <code>Manage</code>, click on <code>App registrations</code>, and click the <code>New registration</code> button on top again.</p></li><li><p>This time, fill out <code>FSHClient</code> as Name, choose again for <code>Accounts in any organizational directory - Multitenant</code> and under <code>Redirect URI</code>, select <code>Single-page application (SPA)</code> and fill out the url <code>https://localhost:5001/swagger/oauth2-redirect.html</code>. Click on <code>Register</code>:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_500x0_resize_lanczos_3.png 500w" width=845 height=566><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api_huba62a80f5866c3c5b151606978986318_23568_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/register-api.png width=845 height=566></noscript></figure></p></li></ul><h3 id=add-permission-for-the-api>Add permission for the Api<a href=#add-permission-for-the-api class=anchor aria-hidden=true>#</a></h3><ul><li><p>On the newly created App&rsquo;s blade, under <code>Manage</code>, click on <code>API permissions</code> and click the <code>Add a permission</code> button:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_500x0_resize_lanczos_3.png 500w" width=853 height=505><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1_huf5ede30cd27b35b526e6f408879be87c_37110_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-1.png width=853 height=505></noscript></figure></p></li><li><p>On the next view, under <code>Select an API</code>, click on <code>My APIs</code> and select FSHApi:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_500x0_resize_lanczos_3.png 500w" width=857 height=269><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2_hu232695f53cd07a72c58a87c2b951d412_12024_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-2.png width=857 height=269></noscript></figure></p></li><li><p>Then, under <code>Select permissions</code>, check the <code>access_as_user</code> permission and click on <code>Add permissions</code>:<figure><img class="doc-img lazyload" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_20x0_resize_lanczos_3.png data-srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_500x0_resize_lanczos_3.png 500w" width=838 height=445><noscript><img class="doc-img img-fluid" srcset="https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_900x0_resize_lanczos_3.png 900w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_800x0_resize_lanczos_3.png 800w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_700x0_resize_lanczos_3.png 700w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_600x0_resize_lanczos_3.png 600w,https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3_hu1c11613c3945c17016838b1d67dcadcb_17877_500x0_resize_lanczos_3.png 500w" src=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/add-permission-3.png width=838 height=445></noscript></figure></p></li></ul><h3 id=add-blazor-client-application>Add Blazor Client application<a href=#add-blazor-client-application class=anchor aria-hidden=true>#</a></h3><p>This should be enough for testing from swagger. But you&rsquo;ll probably will want to use the client application as well. There&rsquo;s 2 options here. Or you can add the <code>Redirect URI</code> for the client application to the same App registration you just created (click on <code>Authentication</code> under <code>Manage</code> and then on <code>Add URI</code>), or you can create a whole new client app registration specifically for this client, just like described in the steps above, but with another <code>Redirect URI</code>. In any case, the <code>Redirect URI</code> for the blazor app you will want to use is <code>https://localhost:5002/authentication/login-callback</code>.</p><h2 id=update-the-azuread-settings-on-the-web-api-project>Update the AzureAd settings on the Web Api project<a href=#update-the-azuread-settings-on-the-web-api-project class=anchor aria-hidden=true>#</a></h2><p>Now that&rsquo;s all set up, the only thing left is updating the configuration to use AzureAd.
On the Web API project, under <code>src\Host\Configurations</code>, open <code>security.json</code> and fill out the required settings:</p><ul><li><code>Provider</code>: set to <code>AzureAd</code></li><li><code>Instance</code>: set to <code>https://login.microsoftonline.com/</code></li><li><code>Domain</code>: you can find your domain in the Azure Active Directory blade on the <code>Overview</code> page under <code>Primary domain</code>.</li><li><code>TenantId</code>: set to <code>organizations</code></li><li><code>ClientId</code>: set to the <code>Application (client) ID</code> of the FSHApi App registration (you can find this on the <code>Overview</code> page of the App registration in Azure)</li><li><code>Scopes</code>: set to <code>access_as_user</code></li><li><code>RootIssuer</code>: set to <code>https://sts.windows.net/&lt;Your Tenant ID>/</code> (your <code>Tenant ID</code> is also on the <code>Overview</code> page of the Azure Active Directory blade)</li></ul><p>Then for swagger to work you need the following settings under the <code>Swagger</code> node in <code>security.json</code>:</p><ul><li><code>AuthorizationUrl</code>: set to <code>https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize</code></li><li><code>TokenUrl</code>: set to <code>https://login.microsoftonline.com/organizations/oauth2/v2.0/token</code></li><li><code>ApiScope</code>: set to the full name of the api scope we created in the FSHApi App registration above (<code>api://&lt;ClientId of the FSHApi App registration>/access_as_user</code>)</li><li><code>OpenIdClientId</code>: set to the <code>Application (client) ID</code> of the FSHClient App registration (or the one you specifically created for swagger).</li></ul><h2 id=update-the-azuread-settings-on-the-blazor-client-project>Update the AzureAd settings on the Blazor Client project<a href=#update-the-azuread-settings-on-the-blazor-client-project class=anchor aria-hidden=true>#</a></h2><p>Then for the blazor client to work, you need the following settings over there in the <code>wwwroot/appsettings.json</code> file:</p><ul><li><code>AuthProvider</code>: set to <code>AzureAd</code></li><li><code>Authority</code>: set to <code>https://login.microsoftonline.com/organizations</code></li><li><code>ClientId</code>: set to the <code>Application (client) ID</code> of the FSHClient App registration (or the one you specifically created for the blazor client).</li><li><code>ValidateAuthority</code>: set to <code>true</code></li><li><code>ApiScope</code>: set to the full name of the api scope we created in the FSHApi App registration (<code>api://&lt;ClientId of the FSHApi App registration>/access_as_user</code>) same as before with the swagger client.</li></ul><h2 id=configuration-for-postman>Configuration for Postman<a href=#configuration-for-postman class=anchor aria-hidden=true>#</a></h2><p>TODO - Coming soon</p><h2 id=test-it-out>Test it out<a href=#test-it-out class=anchor aria-hidden=true>#</a></h2><ul><li><p>Start the Web API project and browse to <code>https://localhost:5001/swagger</code> when you click on the <code>Authorize</code> button on the top right, you should be redirected to the Microsoft login site. Log in with a user to which you granted app roles and you should be redirected back to swagger with the padlock closed. When you now issue an api call, the Authorization header should be sent with the bearer token received from AzureAd.</p></li><li><p>Start the Blazor Client project and browse to <code>https://localhost:5002/</code>. You should be immediately redirected to the Microsoft login site. And after logging in, you should be redirected back to the homepage of the blazor client.</p></li></ul><h2 id=azuread-and-multitenancy>AzureAd and multitenancy<a href=#azuread-and-multitenancy class=anchor aria-hidden=true>#</a></h2><p>About the <code>RootIssuer</code>setting in <code>security.json</code>. This should be set to the issuer of the root tenant in AzureAd. When someone is logging in from that AzureAD tenant, the local root tenant will automatically be selected.</p><p>For the other tenants there&rsquo;s an &ldquo;issuer&rdquo; field in the tenants table to map those. There&rsquo;s still a part which has to be implemented for mutltiple tenants from AzureAd though, as there needs to be some kind of &ldquo;onboarding&rdquo; experience inside AzureAD when a new tenant needs access to you application. See <a href=https://docs.microsoft.com/en-us/azure/architecture/multitenant-identity/signup>https://docs.microsoft.com/en-us/azure/architecture/multitenant-identity/signup</a> for more info about this.</p><h2 id=azuread-usersroles-vs-local-usersroles>AzureAd users/roles vs. local users/roles<a href=#azuread-usersroles-vs-local-usersroles class=anchor aria-hidden=true>#</a></h2><p>In any case, with AzureAd, when a user logs in and there doesn&rsquo;t exist a local user yet in the local tenant for that AzureAd user/tenant, one gets created automatically. It will also immediately have the same roles assigned like the ones in AzureAd. When an already existing user logs in and there are roles in AzureAd for that user which are not yet assigned to the local user, they will automatically be assigned. Currently there will never be any roles removed from a user. So removing the role assignment from AzureAd will not automatically remove it from the local user when he logs in. This to allow for people to use the role/permission management inside the app without having to do it in Azure.</p><p style=font-size:small>Want to add in More Details or Update this Document ?</p><a class="btn btn-primary btn-lg px-4 mb-2" style=font-size:medium href=https://github.com/fullstackhero/docs/blob/main/content/dotnet-webapi-boilerplate/tutorials/azure-ad-guide/index.md target=_blank role=button><svg style="margin-right:10px" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this Document on GitHub</a><div class="docs-navigation d-flex justify-content-between"><a href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/crud-guide/><div class="card my-1"><div class="card-body py-2">&larr; Performing CRUD Operations</div></div></a><a class=ms-auto href=https://fullstackhero.net/dotnet-webapi-boilerplate/tutorials/deploying-to-iis/><div class="card my-1"><div class="card-body py-2">Deploying to IIS &rarr;</div></div></a></div><div class=support-card><h4 style=margin:5px>Like fullstackhero?</h4><p>Support the project for the longer run!</p><a class="btn btn-primary btn-lg px-4 mb-2" style=font-size:medium href=https://www.buymeacoffee.com/codewithmukesh target=_blank role=button><i style=margin-right:5px class="fas fa-mug-hot"></i>Buy
me
a Coffee</a>
<a class="btn btn-primary btn-lg px-4 mb-2" style=font-size:medium href=https://opencollective.com/fullstackhero target=_blank role=button><i style=margin-right:5px class="fas fa-star"></i> Sponsor</a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Developed & Maintained by <a href=https://www.codewithmukesh.com/>Mukesh Murugan</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://fullstackhero.net/js/highlight.min.88df7ec5d9693ad9d3c4f131a6974c6b0d00561526e939ea196b4f198ecdcfbac25d69d58367fde8df923823110dba6d1a7eabe44b7ea52559e92d0751b17869.js integrity="sha512-iN9+xdlpOtnTxPExppdMaw0AVhUm6TnqGWtPGY7Nz7rCXWnVg2f96N+SOCMRDbptGn6r5Et+pSVZ6S0HUbF4aQ==" crossorigin=anonymous defer></script>
<script src=https://fullstackhero.net/js/vendor/katex/dist/katex.min.bcada504b3ec326107c39e7297015498140149b826ef1a9ca9e43f49afecab252b5623be3bea1e0a8663236740fba5368d9e84b8630aedea1a1926dd3f199a3c.js integrity="sha512-vK2lBLPsMmEHw55ylwFUmBQBSbgm7xqcqeQ/Sa/sqyUrViO+O+oeCoZjI2dA+6U2jZ6EuGMK7eoaGSbdPxmaPA==" crossorigin=anonymous defer></script>
<script src=https://fullstackhero.net/js/vendor/katex/dist/contrib/auto-render.min.bc779bab10cdc862f139e7cd6255a8f021bc483db2b7bc6d553238fb220e937dbe5cd511100d2ab764ee5d9f9092a2cdcc4e6ae109966efc18338f0b275d927d.js integrity="sha512-vHebqxDNyGLxOefNYlWo8CG8SD2yt7xtVTI4+yIOk32+XNUREA0qt2TuXZ+QkqLNzE5q4QmWbvwYM48LJ12SfQ==" crossorigin=anonymous defer></script>
<script src=https://fullstackhero.net/main.min.25cdb7419aabf9517a7272eef61b8ae9bf11b7f8c76fdf5365aa2099652408dabbf0b32e428c16de79c5debbc905f5cc65abc8e3b4b8e8884d7774fca3312eb3.js integrity="sha512-Jc23QZqr+VF6cnLu9huK6b8Rt/jHb99TZaogmWUkCNq78LMuQowW3nnF3rvJBfXMZavI47S46IhNd3T8ozEusw==" crossorigin=anonymous defer></script>
<script src=https://fullstackhero.net/index.min.b5886505afd18d723c5bb410bb8604e8157835c70af96af8108e930e6a72ea95415c1f5883286ca98d2bb66b065426d596253d650ff732a6180c1005bd931f35.js integrity="sha512-tYhlBa/RjXI8W7QQu4YE6BV4NccK+Wr4EI6TDmpy6pVBXB9YgyhsqY0rtmsGVCbVliU9ZQ/3MqYYDBAFvZMfNQ==" crossorigin=anonymous defer></script>
<script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=codewithmukesh data-description="Support me on Buy me a coffee!" data-message data-color=#65bf96 data-position=Right data-x_margin=18 data-y_margin=18></script></body></html>